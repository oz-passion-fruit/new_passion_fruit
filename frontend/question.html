<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì§ˆë¬¸ - Passion Fruit</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container fade-in">
        <header>
            <h1>ğŸŠ Passion Fruit</h1>
            <nav class="nav-links">
                <a href="/">í™ˆ</a>
                <a href="diary.html">ì¼ê¸°</a>
                <a href="question.html">ì§ˆë¬¸</a>
                <a href="quote.html">ëª…ì–¸</a>
            </nav>
            <div class="user-info" id="user-info" style="display: none;">
                <span class="user-email" id="user-email"></span>
                <button class="btn btn-secondary" onclick="authAPI.logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            <div id="auth-links" style="display: flex; gap: 10px;">
                <a href="auth.html" class="btn btn-primary">ë¡œê·¸ì¸</a>
            </div>
        </header>

        <main>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="color: #667eea; font-size: 2.5em;">ğŸ’­ ì˜¤ëŠ˜ì˜ ì§ˆë¬¸</h2>
                <button class="btn btn-primary" onclick="loadRandomQuestion()">
                    ğŸ”„ ìƒˆë¡œìš´ ì§ˆë¬¸
                </button>
            </div>

            <!-- ëœë¤ ì§ˆë¬¸ -->
            <div id="random-question" class="loading">ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

            <!-- ì§ˆë¬¸ ëª©ë¡ -->
            <section style="margin-top: 60px;">
                <h3 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">ëª¨ë“  ì§ˆë¬¸</h3>
                <div style="text-align: right; margin-bottom: 20px;">
                    <span id="question-count" style="color: #999;"></span>
                </div>
                <div id="questions-list" class="grid"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="loadMoreQuestions()" id="load-more-btn">
                        ë” ë³´ê¸°
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script src="js/api.js"></script>
    <script>
        let currentSkip = 0;
        const limit = 12;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', async () => {
            await loadRandomQuestion();
            await loadQuestionCount();
            await loadQuestions();
        });

        // ëœë¤ ì§ˆë¬¸ ë¡œë“œ
        async function loadRandomQuestion() {
            try {
                const question = await questionAPI.getRandom();
                const randomQuestionDiv = document.getElementById('random-question');
                randomQuestionDiv.innerHTML = `
                    <div class="question-card fade-in">
                        <div class="question-text">${question.question}</div>
                        <div style="margin-top: 30px; text-align: center;">
                            <p style="opacity: 0.9; font-size: 0.9em;">
                                ì´ ì§ˆë¬¸ì— ëŒ€í•´ ì¼ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
                            </p>
                            <a href="diary.html" class="btn" style="background: rgba(255,255,255,0.3); color: white; margin-top: 15px;">
                                ì¼ê¸° ì“°ê¸° â†’
                            </a>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('random-question').innerHTML = 
                    '<p style="color: #999;">ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ì§ˆë¬¸ ê°œìˆ˜ ë¡œë“œ
        async function loadQuestionCount() {
            try {
                const data = await questionAPI.getCount();
                document.getElementById('question-count').textContent = 
                    `ì´ ${data.total}ê°œì˜ ì§ˆë¬¸`;
            } catch (error) {
                console.error(error);
            }
        }

        // ì§ˆë¬¸ ëª©ë¡ ë¡œë“œ
        async function loadQuestions() {
            try {
                const questions = await questionAPI.getAll(currentSkip, limit);
                const questionsList = document.getElementById('questions-list');

                if (questions.length === 0 && currentSkip === 0) {
                    questionsList.innerHTML = '<p style="color: #999;">ì•„ì§ ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                const questionsHTML = questions.map(question => `
                    <div class="card fade-in">
                        <div class="card-content" style="font-size: 1.1em; color: #333;">
                            ${question.question}
                        </div>
                    </div>
                `).join('');

                if (currentSkip === 0) {
                    questionsList.innerHTML = questionsHTML;
                } else {
                    questionsList.innerHTML += questionsHTML;
                }

                // ë” ë³´ê¸° ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
                if (questions.length < limit) {
                    document.getElementById('load-more-btn').style.display = 'none';
                }
            } catch (error) {
                showError('ì§ˆë¬¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë” ë§ì€ ì§ˆë¬¸ ë¡œë“œ
        async function loadMoreQuestions() {
            currentSkip += limit;
            await loadQuestions();
        }
    </script>
</body>
</html>

