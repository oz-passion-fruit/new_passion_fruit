<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª…ì–¸ - Passion Fruit</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container fade-in">
        <header>
            <h1>ğŸŠ Passion Fruit</h1>
            <nav class="nav-links">
                <a href="/">í™ˆ</a>
                <a href="diary.html">ì¼ê¸°</a>
                <a href="question.html">ì§ˆë¬¸</a>
                <a href="quote.html">ëª…ì–¸</a>
            </nav>
            <div class="user-info" id="user-info" style="display: none;">
                <span class="user-email" id="user-email"></span>
                <button class="btn btn-secondary" onclick="authAPI.logout()">ë¡œê·¸ì•„ì›ƒ</button>
            </div>
            <div id="auth-links" style="display: flex; gap: 10px;">
                <a href="auth.html" class="btn btn-primary">ë¡œê·¸ì¸</a>
            </div>
        </header>

        <main>
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 20px;">
                <h2 style="color: #667eea; font-size: 2.5em;">âœ¨ ì˜¤ëŠ˜ì˜ ëª…ì–¸</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <select id="author-filter" class="btn btn-secondary" style="padding: 10px 15px;" onchange="filterByAuthor()">
                        <option value="">ëª¨ë“  ì‘ê°€</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadRandomQuote()">
                        ğŸ”„ ìƒˆë¡œìš´ ëª…ì–¸
                    </button>
                </div>
            </div>

            <!-- ëœë¤ ëª…ì–¸ -->
            <div id="random-quote" class="loading">ëª…ì–¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

            <!-- ëª…ì–¸ ëª©ë¡ -->
            <section style="margin-top: 60px;">
                <h3 style="color: #667eea; font-size: 2em; margin-bottom: 20px;">ëª¨ë“  ëª…ì–¸</h3>
                <div style="text-align: right; margin-bottom: 20px;">
                    <span id="quote-count" style="color: #999;"></span>
                </div>
                <div id="quotes-list" class="grid"></div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="loadMoreQuotes()" id="load-more-btn">
                        ë” ë³´ê¸°
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script src="js/api.js"></script>
    <script>
        let currentSkip = 0;
        const limit = 12;
        let selectedAuthor = null;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ
        document.addEventListener('DOMContentLoaded', async () => {
            await loadRandomQuote();
            await loadQuoteCount();
            await loadAuthors();
            await loadQuotes();
        });

        // ëœë¤ ëª…ì–¸ ë¡œë“œ
        async function loadRandomQuote() {
            try {
                const quote = await quoteAPI.getRandom();
                const randomQuoteDiv = document.getElementById('random-quote');
                randomQuoteDiv.innerHTML = `
                    <div class="quote-card fade-in">
                        <div class="quote-text">"${quote.content}"</div>
                        ${quote.author ? `<div class="quote-author">- ${quote.author}</div>` : ''}
                        <div style="margin-top: 30px; text-align: center;">
                            <p style="opacity: 0.9; font-size: 0.9em;">
                                ì´ ëª…ì–¸ì—ì„œ ì˜ê°ì„ ë°›ì•„ ì¼ê¸°ë¥¼ ì‘ì„±í•´ë³´ì„¸ìš”
                            </p>
                            <a href="diary.html" class="btn" style="background: rgba(255,255,255,0.3); color: white; margin-top: 15px;">
                                ì¼ê¸° ì“°ê¸° â†’
                            </a>
                        </div>
                    </div>
                `;
            } catch (error) {
                document.getElementById('random-quote').innerHTML = 
                    '<p style="color: #999;">ëª…ì–¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
        }

        // ëª…ì–¸ ê°œìˆ˜ ë¡œë“œ
        async function loadQuoteCount() {
            try {
                const data = await quoteAPI.getCount();
                document.getElementById('quote-count').textContent = 
                    `ì´ ${data.total}ê°œì˜ ëª…ì–¸`;
            } catch (error) {
                console.error(error);
            }
        }

        // ì‘ê°€ ëª©ë¡ ë¡œë“œ
        async function loadAuthors() {
            try {
                const authors = await quoteAPI.getAuthors();
                const authorFilter = document.getElementById('author-filter');
                
                authors.forEach(item => {
                    const option = document.createElement('option');
                    option.value = item.author;
                    option.textContent = item.author;
                    authorFilter.appendChild(option);
                });
            } catch (error) {
                console.error(error);
            }
        }

        // ì‘ê°€ í•„í„°ë§
        function filterByAuthor() {
            selectedAuthor = document.getElementById('author-filter').value || null;
            currentSkip = 0;
            document.getElementById('load-more-btn').style.display = 'block';
            loadQuotes();
        }

        // ëª…ì–¸ ëª©ë¡ ë¡œë“œ
        async function loadQuotes() {
            try {
                const quotes = await quoteAPI.getAll(currentSkip, limit, selectedAuthor);
                const quotesList = document.getElementById('quotes-list');

                if (quotes.length === 0 && currentSkip === 0) {
                    quotesList.innerHTML = '<p style="color: #999;">ì•„ì§ ë“±ë¡ëœ ëª…ì–¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                    return;
                }

                const quotesHTML = quotes.map(quote => `
                    <div class="card fade-in">
                        <div class="card-content" style="font-size: 1.1em; color: #333; font-style: italic;">
                            "${quote.content}"
                        </div>
                        ${quote.author ? `
                            <div class="card-meta">
                                <span style="font-weight: 500; color: #667eea;">- ${quote.author}</span>
                            </div>
                        ` : ''}
                    </div>
                `).join('');

                if (currentSkip === 0) {
                    quotesList.innerHTML = quotesHTML;
                } else {
                    quotesList.innerHTML += quotesHTML;
                }

                // ë” ë³´ê¸° ë²„íŠ¼ í‘œì‹œ/ìˆ¨ê¹€
                if (quotes.length < limit) {
                    document.getElementById('load-more-btn').style.display = 'none';
                }
            } catch (error) {
                showError('ëª…ì–¸ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë” ë§ì€ ëª…ì–¸ ë¡œë“œ
        async function loadMoreQuotes() {
            currentSkip += limit;
            await loadQuotes();
        }
    </script>
</body>
</html>

